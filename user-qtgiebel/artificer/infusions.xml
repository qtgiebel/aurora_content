<?xml version="1.0" encoding="utf-8" ?>
<elements>
	<info>
        <name>Artificer Infusions</name>
		<update version="0.1.1">
            <file name="infusions.xml" url="https://raw.githubusercontent.com/qtgiebel/aurora_content/main/user-qtgiebel/artificer/infusions.xml" />
        </update>
	</info>

    <element name="Homunculus Servant" type="Class Feature" source="User Defined" id="ID_USERDEFINED_ARTIFICER_CLASS_FEATURE_ARTIFICER_INFUSION_HOMUNCULUS_SERVANT">
        <supports>Artificer Infusion</supports>
        <description>
            <p><em>Item: A gem or crystal worth at least 100 gp</em></p>
            <p>You learn intricate methods for magically creating a special homunculus that serves you. The item you infuse serves as the creature’s heart, around which the creature’s body instantly forms.</p>
            <p class="indent">You determine the homunculus’s appearance. Some artificers prefer mechanical-looking birds, whereas some like winged vials or miniature, animate cauldrons.</p>
            <p class="indent">The homunculus is friendly to you and your companions, and it obeys your commands. See this creature’s game statistics in the Homunculus Servant stat block.</p>
            <p class="indent">In combat, the homunculus shares your initiative count, but it takes its turn immediately after yours. It can move and use its reaction on its own, but the only action it takes on its turn is the Dodge action, unless you take a bonus action on your turn to command it to take another action. That action can be one in its stat block or some other action. If you are incapacitated, the homunculus can take any action of its choice, not just Dodge.</p>
            <p class="indent">The homunculus regains 2d6 hit points if the mending spell is cast on it. If you or the homunculus dies, it vanishes, leaving its heart in its space.</p>
        </description>
        <sheet>
            <description>You can infuse a gem worth at least 100 gpinto a homunculus servant.
            In combat, the homunculus shares your initiative count, but it takes its turn immediately after yours. It can move and use its reaction on its own, but the only action it takes on its turn is the Dodge action, unless you take a bonus action on your turn to command it to take another action. That action can be one in its stat block or some other action. If you are incapacitated, the homunculus can take any action of its choice, not just Dodge.
            The homunculus regains 2d6 hit points if the mending spell is cast on it. If you or the homunculus dies, it vanishes, leaving its heart in its space.</description>
        </sheet>>
        <rules>
            <select type="Companion" name="Homunculus Servant" supports="Homunculus Servant" />
        </rules>
    </element>

    <element name="Homunculus Servant" type="Companion" source="User Defined" id="ID_USERDEFINED_ARTIFICER_CLASS_FEATURE_ARTIFICER_INFUSION_HOMUNCULUS_SERVANT">
		<supports>Homunculus Servant</supports>
		<description>
			<p>Your tinkering has borne you a faithful companion, a homunculus servant. It is friendly to you and your companions, and it obeys your commands.</p>
		</description>
		<setters>
			<set name="strength">4</set>
			<set name="dexterity">15</set>
			<set name="constitution">12</set>
			<set name="intelligence">10</set>
			<set name="wisdom">10</set>
			<set name="charisma">7</set>
			<set name="ac">13 (natural armor)</set>
			<set name="hp">1 + your Intelligence modifier + your artificer level (the homunculus has a number of Hit Dice [d4s] equal to your artificer level)</set>
			<set name="speed">20 ft., fly 30 ft.</set>
			<set name="immunities">poison</set>
			<set name="conditionImmunities">exhaustion, poisoned</set>			
			<set name="saves">Dex +3 plus PB</set>
			<set name="skills">Perception +0 plus PB x 2, Stealth +2 plus PB</set>
			<set name="senses">darkvision 60 ft., passive Perception 10 + (PB x 2)</set>
			<set name="languages">understands the languages you speak</set>
			<set name="type">Construct</set>
			<set name="size">Tiny</set>
			<set name="challenge">-</set>
			<set name="traits">ID_USERDEFINED_COMPANION_TRAIT_HOMUNCULUS_SERVANT_EVASION</set> 
			<set name="actions">ID_USERDEFINED_COMPANION_TRAIT_HOMUNCULUS_SERVANT_FORCE_STRIKE</set> 
			<set name="reactions">ID_USERDEFINED_COMPANION_TRAIT_HOMUNCULUS_SERVANT_CHANNEL_MAGIC</set> 
		</setters>
		<rules>
			<stat name="companion:ac" value="13" bonus="base" />
			<stat name="companion:hp:max" value="companion:constitution:modifier" />
			<stat name="companion:hp:max" value="intelligence:modifier" />
			<stat name="companion:hp:max" value="level:artificer" />
			<stat name="companion:speed" value="20" bonus="base" />	
			<stat name="companion:perception:proficiency" value="companion:proficiency" bonus="proficiency" />
			<stat name="companion:perception:proficiency" value="companion:proficiency" bonus="double" />
			<stat name="companion:stealth:proficiency" value="companion:proficiency" bonus="proficiency" />
			<stat name="companion:dexterity:save:proficiency" value="companion:proficiency" bonus="proficiency" />
			<grant type="Companion Trait" id="ID_USERDEFINED_COMPANION_TRAIT_HOMUNCULUS_SERVANT_EVASION" />
		</rules>
	</element>

	<element name="Evasion" type="Companion Trait" source="User Defined" id="ID_USERDEFINED_COMPANION_TRAIT_HOMUNCULUS_SERVANT_EVASION">
		<description>
			<p>If the homunculus is subjected to an effect that allows it to make a Dexterity saving throw to take only half damage, it instead takes no damage if it succeeds on the saving throw, and only half damage if it fails. It can't use this trait if it's incapacitated.</p>
		</description>
		<sheet>
			<description>If the homunculus is subjected to an effect that allows it to make a Dexterity saving throw to take only half damage, it instead takes no damage if it succeeds on the saving throw, and only half damage if it fails. It can't use this trait if it's incapacitated.</description>
		</sheet>
	</element>

	<element name="Force Strike" type="Companion Action" source="User Defined" id="ID_USERDEFINED_COMPANION_TRAIT_HOMUNCULUS_SERVANT_FORCE_STRIKE">
		<description>
			<p>Ranged Weapon Attack: your spell attack modifier to hit, range 30 ft., one target you can see. Hit: 1d4 + PB force damage.</p>
		</description>
		<sheet>
			<description>Ranged Weapon Attack: +6 to hit, 30 ft., one target you can see. Hit: 1d4 + 2 force damage.</description>
		</sheet>
	</element>

	<element name="Channel Magic" type="Companion Reaction" source="User Defined" id="ID_USERDEFINED_COMPANION_TRAIT_HOMUNCULUS_SERVANT_CHANNEL_MAGIC">
		<description>
			<p>The homunculus delivers a spell you cast that has a range of touch. The homunculus must be within 120 feet of you.</p>
		</description>
		<sheet>
			<description>The homunculus delivers a spell you cast that has a range of touch. The homunculus must be within 120 feet of you.</description>
		</sheet>
	</element>
</elements>